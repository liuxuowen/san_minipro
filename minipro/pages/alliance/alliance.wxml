<view class="container">
  <view class="card">
    <view class="title">上传同盟统计数据</view>
    <view class="desc">上传最新同盟统计，系统会保存成员数据用于后续分析，一个账号只支持一个同盟。</view>
    <button class="upload-btn" bindtap="chooseFile">选择文件 (CSV)</button>
    <view class="note">文件名需包含导出时间（示例：同盟统计2025年01月25日13时30分12秒.csv）。</view>
  </view>

  <view class="card" wx:if="{{uploads.length > 0}}">
    <view class="section-header alliance-name-container">
      <text class="section-title">我的同盟数据</text>
      <view class="alliance-name-wrapper" bindtap="editAllianceName">
        <text class="alliance-name">{{allianceName || '设置联盟名称'}}</text>
        <text class="edit-icon">✎</text>
      </view>
    </view>
    
    <view class="analysis-actions">
      <button class="analysis-btn {{canCompare ? '' : 'is-disabled'}}" bindtap="onAnalyze" data-type="battle">战功差值</button>
      <button class="analysis-btn {{canCompare ? '' : 'is-disabled'}}" bindtap="onAnalyze" data-type="power">势力差值</button>
      <button class="analysis-btn {{canCompare ? '' : 'is-disabled'}}" bindtap="onAnalyze" data-type="assist">攻城差值</button>
      <button class="analysis-btn {{canCompare ? '' : 'is-disabled'}}" bindtap="onAnalyze" data-type="donation">罚款捐献</button>
    </view>

    <view class="uploads-list">
      <block wx:for="{{uploads}}" wx:key="id">
        <view class="upload-item {{item.selected ? 'is-selected' : ''}}">
          <view class="upload-info" bindtap="toggleSelection" data-id="{{item.id}}">
            <text class="upload-text">{{item.display_time}}</text>
          </view>
          <view class="upload-detail-link" catchtap="viewDetail" data-id="{{item.id}}">
            <text>（成员数: {{item.member_count}}）</text>
          </view>
          <view class="delete-btn" catchtap="deleteUpload" data-id="{{item.id}}">删除</view>
        </view>
      </block>
    </view>
  </view>
</view>
